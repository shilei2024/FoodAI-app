<!-- components/image-cropper/index.wxml -->
<view class="image-cropper-container">
  <!-- 裁剪区域 -->
  <view class="cropper-area">
    <!-- 图片容器 -->
    <view 
      class="image-container"
      style="
        width: {{containerWidth}}px;
        height: {{containerHeight}}px;
        transform: translate({{translateX}}px, {{translateY}}px) scale({{scale}});
      "
      bindtouchstart="onTouchStart"
      bindtouchmove="onTouchMove"
      bindtouchend="onTouchEnd"
    >
      <image
        class="cropper-image"
        src="{{imageSrc}}"
        mode="widthFix"
        style="
          width: {{imageWidth}}px;
          height: {{imageHeight}}px;
          transform: rotate({{rotation}}deg);
        "
        bindload="onImageLoad"
      />
    </view>
    
    <!-- 裁剪框 -->
    <view 
      class="crop-frame"
      style="
        width: {{cropWidth}}px;
        height: {{cropHeight}}px;
        top: {{cropTop}}px;
        left: {{cropLeft}}px;
      "
    >
      <!-- 裁剪框边框 -->
      <view class="crop-border"></view>
      
      <!-- 裁剪框角点 -->
      <view class="corner top-left" data-corner="top-left"></view>
      <view class="corner top-right" data-corner="top-right"></view>
      <view class="corner bottom-left" data-corner="bottom-left"></view>
      <view class="corner bottom-right" data-corner="bottom-right"></view>
      
      <!-- 裁剪框网格线 -->
      <view class="grid-line vertical-1"></view>
      <view class="grid-line vertical-2"></view>
      <view class="grid-line horizontal-1"></view>
      <view class="grid-line horizontal-2"></view>
    </view>
    
    <!-- 遮罩层 -->
    <view class="overlay">
      <view 
        class="mask top"
        style="height: {{cropTop}}px;"
      ></view>
      <view class="mask middle">
        <view 
          class="mask left"
          style="width: {{cropLeft}}px;"
        ></view>
        <view class="crop-area"></view>
        <view 
          class="mask right"
          style="width: {{maskRightWidth}}px;"
        ></view>
      </view>
      <view 
        class="mask bottom"
        style="height: {{maskBottomHeight}}px;"
      ></view>
    </view>
  </view>
  
  <!-- 操作区域 -->
  <view class="control-area">
    <!-- 比例选择 -->
    <view class="ratio-selector" wx:if="{{showRatioSelector}}">
      <text class="ratio-title">裁剪比例：</text>
      <view class="ratio-buttons">
        <van-button
          wx:for="{{ratioOptions}}"
          wx:key="value"
          type="{{activeRatio === item.value ? 'primary' : 'default'}}"
          size="mini"
          round
          bindtap="onRatioChange"
          data-ratio="{{item.value}}"
          custom-class="ratio-button"
        >
          {{item.label}}
        </van-button>
      </view>
    </view>
    
    <!-- 操作按钮 -->
    <view class="action-buttons">
      <!-- 旋转 -->
      <van-button
        type="default"
        size="small"
        icon="replay"
        bindtap="onRotate"
        custom-class="action-button"
      >
        旋转
      </van-button>
      
      <!-- 重置 -->
      <van-button
        type="default"
        size="small"
        icon="replay"
        bindtap="onReset"
        custom-class="action-button"
      >
        重置
      </van-button>
      
      <!-- 缩放控制 -->
      <view class="zoom-controls">
        <van-button
          type="default"
          size="mini"
          icon="minus"
          bindtap="onZoomOut"
          disabled="{{scale <= minScale}}"
          custom-class="zoom-button"
        ></van-button>
        
        <text class="zoom-text">{{Math.round(scale * 100)}}%</text>
        
        <van-button
          type="default"
          size="mini"
          icon="plus"
          bindtap="onZoomIn"
          disabled="{{scale >= maxScale}}"
          custom-class="zoom-button"
        ></van-button>
      </view>
      
      <!-- 取消 -->
      <van-button
        type="default"
        size="small"
        icon="close"
        bindtap="onCancel"
        custom-class="action-button"
      >
        取消
      </van-button>
      
      <!-- 确定 -->
      <van-button
        type="primary"
        size="small"
        icon="success"
        bindtap="onConfirm"
        custom-class="action-button"
      >
        确定裁剪
      </van-button>
    </view>
    
    <!-- 尺寸显示 -->
    <view class="size-info">
      <text>裁剪尺寸：{{cropWidth}} × {{cropHeight}} 像素</text>
      <text wx:if="{{outputSize}}">输出大小：{{outputSize}}</text>
    </view>
  </view>
  
  <!-- 加载状态 -->
  <van-loading
    wx:if="{{loading}}"
    type="spinner"
    color="#07c160"
    size="48rpx"
    custom-class="loading-overlay"
  >
    处理中...
  </van-loading>
</view>
