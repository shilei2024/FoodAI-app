<!--pages/history/history.wxml-->
<view class="container">
  <!-- 统计信息 -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value">{{stats.total}}</text>
        <text class="stat-label">总记录</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.today}}</text>
        <text class="stat-label">今日</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.week}}</text>
        <text class="stat-label">本周</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.month}}</text>
        <text class="stat-label">本月</text>
      </view>
    </view>
  </view>

  <!-- 筛选标签 -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filterType === 'all' ? 'active' : ''}}" 
        bindtap="switchFilter"
        data-type="all"
      >全部</view>
      <view 
        class="filter-tab {{filterType === 'today' ? 'active' : ''}}" 
        bindtap="switchFilter"
        data-type="today"
      >今日</view>
      <view 
        class="filter-tab {{filterType === 'week' ? 'active' : ''}}" 
        bindtap="switchFilter"
        data-type="week"
      >本周</view>
      <view 
        class="filter-tab {{filterType === 'month' ? 'active' : ''}}" 
        bindtap="switchFilter"
        data-type="month"
      >本月</view>
    </view>
  </view>

  <!-- 历史记录列表 -->
  <view class="history-section">
    <!-- 操作按钮 -->
    <view class="action-buttons" wx:if="{{historyList.length > 0}}">
      <van-button 
        type="default" 
        size="small" 
        icon="delete-o" 
        bindtap="clearHistory"
      >
        清空历史
      </van-button>
      <van-button 
        type="primary" 
        size="small" 
        icon="down" 
        bindtap="exportData"
      >
        导出数据
      </van-button>
    </view>

    <!-- 记录列表 -->
    <view class="history-list">
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{historyList.length === 0 && !loading}}">
        <van-icon name="search" size="80" color="#c8c9cc" />
        <text class="empty-text">暂无历史记录</text>
        <text class="empty-hint">去首页搜索或拍照识别食物吧</text>
      </view>
      
      <!-- 记录项 -->
      <view 
        wx:for="{{historyList}}" 
        wx:key="id"
        class="history-item"
        bindtap="viewDetail"
        data-id="{{item.id}}"
        data-index="{{index}}"
      >
        <!-- 使用 food-card 组件 -->
        <food-card food="{{item}}" />
        
        <!-- 额外信息 -->
        <view class="item-extra">
          <view class="item-time">
            <van-icon name="clock-o" size="14" color="#999" />
            <text class="time-text">{{item.time}}</text>
          </view>
          
          <view class="item-tags">
            <van-tag 
              wx:if="{{item.type === 'ai' || item.source === 'ai_recognition'}}" 
              type="primary" 
              size="mini"
              custom-class="tag-item"
            >
              AI识别
            </van-tag>
            <van-tag 
              wx:elif="{{item.type === 'search' || item.source === 'text_search'}}" 
              type="success" 
              size="mini"
              custom-class="tag-item"
            >
              文字搜索
            </van-tag>
            <van-tag 
              wx:else 
              type="warning" 
              size="mini"
              custom-class="tag-item"
            >
              手动添加
            </van-tag>
          </view>
          
          <view class="item-actions" catchtap="stopPropagation">
            <van-button 
              type="danger" 
              size="mini" 
              plain
              catchtap="deleteRecord"
              data-id="{{item.id}}"
            >
              删除
            </van-button>
          </view>
        </view>
      </view>

      <!-- 加载更多 -->
      <view class="load-more" wx:if="{{loading}}">
        <van-loading size="24px">加载中...</van-loading>
      </view>
      <view class="load-more" wx:if="{{!hasMore && historyList.length > 0}}">
        <text class="no-more">没有更多了</text>
      </view>
    </view>
  </view>
</view>
