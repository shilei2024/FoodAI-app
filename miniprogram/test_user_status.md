# 用户状态管理功能测试指南

## 功能概述

已实现以下用户状态管理功能：

### 1. 游客状态检测和显示
- 未登录时显示为"游客"状态
- 所有功能均无法使用（拍照识别、搜索识别）
- 显示清晰的提示信息引导用户登录

### 2. 登录状态管理
- 支持用户登录/退出
- 登录后显示用户信息
- 状态实时更新

### 3. 使用次数限制
- **拍照识别**：每天5次（登录用户）
- **搜索识别**：每天10次（登录用户）
- 实时显示剩余次数
- 次数用完时显示提示

### 4. UI提示和引导
- 首页顶部显示用户状态卡片
- 显示今日使用次数统计
- 清晰的权限提示对话框
- 引导用户登录的按钮

## 测试步骤

### 测试1：游客状态
1. 清除小程序缓存（或首次打开）
2. 观察首页顶部显示"游客"状态
3. 尝试点击拍照按钮 - 应弹出登录提示
4. 尝试搜索食物 - 应弹出登录提示
5. 验证所有功能均无法使用

### 测试2：用户登录
1. 点击"登录"按钮
2. 系统会自动创建模拟用户
3. 观察状态变为"已登录"
4. 使用次数应重置为0/5和0/10

### 测试3：拍照识别次数限制
1. 登录后，拍照识别5次
2. 每次识别后观察剩余次数减少
3. 第6次尝试拍照时，应显示"今日拍照识别次数已用完"
4. 验证无法继续使用拍照功能

### 测试4：搜索识别次数限制
1. 登录后，搜索识别10次
2. 每次搜索后观察剩余次数减少
3. 第11次尝试搜索时，应显示"今日搜索识别次数已用完"
4. 验证无法继续使用搜索功能

### 测试5：用户退出
1. 点击"退出"按钮
2. 状态应恢复为"游客"
3. 所有功能应再次无法使用
4. 使用次数统计应隐藏

### 测试6：个人页面
1. 导航到"我的"页面
2. 查看用户信息
3. 查看使用次数统计
4. 测试登录/退出功能

## 预期结果

### 首页显示：
```
用户状态：游客
拍照识别：0/5次（请登录后使用）
搜索识别：0/10次（请登录后使用）
```

### 登录后显示：
```
用户状态：已登录
拍照识别：2/5次（剩余3次）
搜索识别：5/10次（剩余5次）
```

### 权限提示：
- 游客尝试使用功能：显示"请先登录"
- 次数用完：显示"今日使用次数已用完"

## 技术实现

### 主要修改文件：
1. `miniprogram/app.js` - 全局用户状态管理
2. `miniprogram/pages/index/index.js` - 首页功能权限检查
3. `miniprogram/pages/index/index.wxml` - 用户状态UI
4. `miniprogram/pages/index/index.wxss` - 用户状态样式
5. `miniprogram/pages/profile/profile.js` - 个人页面集成
6. `miniprogram/pages/profile/profile.wxml` - 个人页面UI

### 核心功能：
- 使用`wx.getStorageSync`/`wx.setStorageSync`存储用户数据
- 每日使用次数基于日期重置
- 权限检查在每次功能调用前执行
- 状态实时同步更新

## 注意事项

1. **数据存储**：用户数据存储在本地，清除缓存会丢失
2. **日期重置**：使用次数每日0点自动重置
3. **模拟登录**：当前使用模拟用户数据，实际项目应集成微信登录
4. **VIP功能**：预留了VIP状态接口，可扩展VIP特权

## 扩展建议

1. **微信登录集成**：替换模拟登录为真实微信登录
2. **云端同步**：将用户数据同步到云端
3. **VIP特权**：实现VIP用户无限制使用
4. **分享奖励**：通过分享增加使用次数
5. **数据统计**：更详细的使用数据分析
