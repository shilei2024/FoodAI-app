# 百度AI直接调用配置说明

## 概述

由于无法使用云函数，本应用采用直接在小程序中调用百度AI API的方式。这种方式会将API密钥暴露在小程序代码中，建议仅用于开发测试，生产环境请使用云函数保护密钥。

## 配置步骤

### 第一步：获取百度AI API密钥

1. 访问 [百度AI开放平台](https://ai.baidu.com/)
2. 使用百度账号登录
3. 完成实名认证（个人或企业）
4. 进入「控制台」→「应用列表」
5. 点击「创建应用」
6. 填写应用信息：
   - 应用名称：`AI轻食记`
   - 应用类型：`工具类`
   - 应用描述：`基于AI的食物识别与营养分析小程序`
   - 接口选择：勾选「图像识别」→「菜品识别」
7. 创建应用后，在应用详情页获取：
   - **API Key**：`xxxxxxxxxxxxxxxxxxxxxxxx`
   - **Secret Key**：`xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### 第二步：配置密钥

1. 打开 `miniprogram/constants/config.js` 文件
2. 找到 `baiduAI` 配置项（约第25行）
3. 将 `apiKey` 和 `secretKey` 替换为您获取的密钥：

```javascript
baiduAI: {
  apiKey: '您的API Key',        // 替换这里
  secretKey: '您的Secret Key',  // 替换这里
  // ... 其他配置
}
```

### 第三步：验证配置

1. 在微信开发者工具中运行小程序
2. 点击首页的「拍照」或「从相册选择」
3. 选择一张食物图片
4. 如果配置正确，应该能看到识别结果
5. 如果出现「请先配置百度AI密钥」的错误，请检查配置是否正确

## 注意事项

### 安全性

⚠️ **重要提示**：
- API密钥会暴露在小程序代码中，任何人都可以通过反编译获取
- 建议仅用于开发测试环境
- 生产环境请使用云函数保护密钥
- 定期轮换API密钥，避免泄露风险

### 配额限制

- 百度AI免费额度：每日500次调用
- 超出免费额度后按量计费
- 建议监控API调用次数，避免产生意外费用

### 网络要求

- 小程序需要配置合法域名
- 需要在微信公众平台配置以下域名：
  - `https://aip.baidubce.com`（百度AI API域名）

### 配置域名步骤

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入「开发」→「开发管理」→「开发设置」
3. 找到「服务器域名」→「request合法域名」
4. 添加域名：`https://aip.baidubce.com`
5. 保存配置（需要等待审核，通常几分钟内生效）

## 常见问题

### Q1: 提示「请先配置百度AI密钥」

**原因**：config.js 中的 apiKey 或 secretKey 未正确配置

**解决方案**：
1. 检查 `miniprogram/constants/config.js` 文件
2. 确认 `apiKey` 和 `secretKey` 已替换为真实密钥
3. 确认密钥格式正确（没有多余空格）

### Q2: 提示「网络请求失败」

**原因**：可能是域名未配置或网络问题

**解决方案**：
1. 检查是否在微信公众平台配置了 `https://aip.baidubce.com` 域名
2. 检查网络连接是否正常
3. 在微信开发者工具中查看网络请求详情

### Q3: 提示「百度AI识别失败: 错误码: xxx」

**原因**：API调用失败，可能是密钥错误、配额用完等

**解决方案**：
1. 检查API密钥是否正确
2. 检查是否超出每日免费额度
3. 查看错误码对应的具体原因（参考百度AI文档）

### Q4: 识别结果不准确

**原因**：图片质量、光线、角度等因素影响识别准确率

**解决方案**：
1. 使用清晰、光线充足的照片
2. 确保食物在图片中清晰可见
3. 避免模糊、反光、阴影等情况
4. 尝试从不同角度拍摄

## 测试建议

1. **功能测试**：
   - 测试拍照识别
   - 测试相册选择识别
   - 测试不同食物的识别
   - 测试错误处理

2. **性能测试**：
   - 测试识别速度（通常2-5秒）
   - 测试网络异常情况
   - 测试并发请求

3. **边界测试**：
   - 测试无效图片
   - 测试非食物图片
   - 测试超大图片
   - 测试网络超时

## 技术支持

- 百度AI文档：https://ai.baidu.com/ai-doc/IMAGERECOGNITION/9k3h7xq8m
- 百度AI控制台：https://console.bce.baidu.com/ai/
- 微信小程序文档：https://developers.weixin.qq.com/miniprogram/dev/framework/

---

**配置完成后，您的AI识别功能应该可以正常工作了！**

