# 首页拍照和文字搜索识别结果区别实现说明

## 需求概述
根据用户需求，需要在首页的拍照和文字搜索识别结果中做以下区别：

1. **拍照/照片识别**：显示实际提供的照片
2. **文字搜索**：第一行显示搜索出来的食物名称和重量（例如："苹果 120克"），下面的内容与拍照识别相同

## 实现方案

### 1. 数据结构修改
在首页的 `index.js` 中修改了结果数据结构，添加了以下字段：
- `searchType`: 搜索类型（'photo'表示拍照识别，'text'表示文字搜索）
- `weight`: 重量信息（仅文字搜索时使用）
- `originalSearchText`: 原始搜索文本（仅文字搜索时使用）
- `allNutrition`: 保存所有营养信息供详情页面使用

### 2. 重量提取功能
实现了 `extractWeightFromSearchText` 函数，用于从搜索文本中提取重量信息：
- 支持常见的重量单位：克、千克、斤、两、磅、盎司等
- 支持中文数量词：一个、两个、一碗、一杯等
- 支持约+数字+单位的格式：约120克、大约1.5千克

### 3. 显示逻辑修改
#### WXML模板修改：
- 根据 `searchType` 显示不同的内容
- 文字搜索时显示食物名称和重量
- 拍照识别时只显示食物名称
- 营养信息只显示前6个（按物质含量从多往低排序）
- 如果有更多营养信息，显示查看详情提示

#### 营养信息排序：
- 所有营养信息按值从大到小排序
- 首页只显示前6个
- 详情页面显示所有营养信息

### 4. 搜索结果处理
修改了 `showSearchResult` 函数：
- 接收重量信息和原始搜索文本
- 设置 `searchType` 为 'text'
- 对营养信息进行排序和截取

### 5. 拍照识别处理
修改了 `showRecognitionResult` 函数：
- 设置 `searchType` 为 'photo'
- 对营养信息进行排序和截取

### 6. 详情页面传递
修改了 `viewDetails` 函数：
- 传递所有营养信息给详情页面
- 传递搜索类型和重量信息

## 新增功能

### 1. 测试页面
创建了 `/pages/test/test` 页面，用于测试重量提取功能：
- 包含5个测试用例
- 可以运行单个测试或所有测试
- 显示详细的测试结果

### 2. 首页测试入口
在首页的调试按钮区域添加了"功能测试"按钮，方便跳转到测试页面

## 样式优化

### 1. 新增CSS样式
- `.food-weight`: 食物重量显示样式
- `.more-nutrition-hint`: 更多营养信息提示样式
- `.hint-text`: 提示文字样式

### 2. 响应式调整
- 小屏幕优化食物名称和重量显示
- 大屏幕增加字体大小和内边距

## 测试用例

### 已实现的测试用例：
1. **文字搜索测试 - 苹果一个，约120克**
   - 搜索文本: "苹果一个，约120克"
   - 期望结果: 食物名称="苹果", 重量="约120克"

2. **文字搜索测试 - 香蕉两根**
   - 搜索文本: "香蕉两根"
   - 期望结果: 食物名称="香蕉", 重量="两根"

3. **文字搜索测试 - 米饭一碗**
   - 搜索文本: "米饭一碗"
   - 期望结果: 食物名称="米饭", 重量="一碗"

4. **文字搜索测试 - 鸡胸肉150g**
   - 搜索文本: "鸡胸肉150g"
   - 期望结果: 食物名称="鸡胸肉", 重量="150g"

5. **文字搜索测试 - 纯食物名称**
   - 搜索文本: "西兰花"
   - 期望结果: 食物名称="西兰花", 重量=""

## 使用说明

### 1. 文字搜索
- 在输入框中输入食物名称和重量，如："苹果一个，约120克"
- 系统会自动提取食物名称和重量信息
- 结果显示食物名称和重量，营养信息按含量从多到少排序，只显示前6个

### 2. 拍照识别
- 点击拍照按钮或从相册选择图片
- 系统识别食物并显示结果
- 结果显示食物图片和名称，营养信息按含量从多到少排序，只显示前6个

### 3. 查看详情
- 点击"查看详情"按钮
- 进入详情页面查看所有营养信息

### 4. 功能测试
- 在首页开启调试模式（`debugMode: true`）
- 点击"功能测试"按钮
- 进入测试页面运行重量提取功能测试

## 文件修改清单

### 修改的文件：
1. `miniprogram/pages/index/index.js` - 主要逻辑修改
2. `miniprogram/pages/index/index.wxml` - 模板修改
3. `miniprogram/pages/index/index.wxss` - 样式修改

### 新增的文件：
1. `miniprogram/pages/test/test.js` - 测试页面逻辑
2. `miniprogram/pages/test/test.wxml` - 测试页面模板
3. `miniprogram/pages/test/test.wxss` - 测试页面样式
4. `miniprogram/pages/test/test.json` - 测试页面配置
5. `首页拍照和文字搜索识别结果区别实现说明.md` - 本文档

## 注意事项

1. **重量提取精度**：重量提取功能基于正则表达式，可能无法覆盖所有格式
2. **营养信息排序**：营养信息按数值排序，单位不同的项目可能排序不准确
3. **测试页面**：测试页面仅用于开发测试，生产环境可以移除或隐藏

## 后续优化建议

1. **重量单位转换**：添加重量单位转换功能
2. **营养信息标准化**：统一营养信息的单位以便准确排序
3. **更多测试用例**：添加更多边缘情况的测试用例
4. **用户反馈**：收集用户实际使用中的搜索文本，优化提取算法
